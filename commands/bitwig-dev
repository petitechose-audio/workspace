#!/usr/bin/env bash
# bitwig-dev - Convenience wrapper for Bitwig controller workflows

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
MS="$SCRIPT_DIR/ms"
CODEBASE="bitwig"

# Allow flags before subcommand (e.g. bitwig-dev --release)
flags=()
while [[ $# -gt 0 && "${1:-}" == -* ]]; do
  flags+=("$1")
  shift
done

sub="upload"
if [[ $# -gt 0 ]]; then
  sub="$1"
  shift
fi

case "$sub" in
  upload|"" )
    exec "$MS" upload "$CODEBASE" "${flags[@]}" "$@"
    ;;
  monitor)
    exec "$MS" monitor "$CODEBASE" "${flags[@]}" "$@"
    ;;
  run)
    exec "$MS" run "$CODEBASE" "${flags[@]}" "$@"
    ;;
  web)
    exec "$MS" web "$CODEBASE" "${flags[@]}" "$@"
    ;;
  build)
    exec "$MS" build "$CODEBASE" "${flags[@]}" "$@"
    ;;
  clean)
    exec "$MS" clean "$CODEBASE" "${flags[@]}" "$@"
    ;;
  icons)
    exec "$MS" icons "$CODEBASE" "${flags[@]}" "$@"
    ;;
  *)
    # Unknown: treat as extra arg to upload
    exec "$MS" upload "$CODEBASE" "${flags[@]}" "$sub" "$@"
    ;;
esac
